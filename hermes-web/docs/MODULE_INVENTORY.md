# ZSCE Agent V4.0 模块清单

## 概述
本文档盘点现有代码库中的模块，标记可复用vs需替换的部分，为V4.0重构提供指导。

## 1. 核心Agent系统 (zswe-agent/)

### ✅ 可复用模块

#### 1.1 基础架构
- **`mcp.py`** - MCP核心调度器
  - 状态: ✅ 可复用
  - 功能: TDD+多轮辩论+人类仲裁工作流
  - 备注: 核心逻辑完整，需要适配V4.0新功能

- **`agents.py`** - Agent实现
  - 状态: ✅ 可复用
  - 功能: DeveloperAgent, ReviewerAgent
  - 备注: 基础Agent逻辑完整，需要扩展支持V4.0新角色

- **`constitution.py`** - 宪法生成器
  - 状态: ✅ 可复用
  - 功能: 动态生成项目宪法
  - 备注: 需要增强支持V4.0的宪法治理功能

- **`llm_api.py`** - LLM接口
  - 状态: ✅ 可复用
  - 功能: 反串通模型分配，多模型支持
  - 备注: 需要扩展支持V4.0的新模型类型

- **`models.py`** - 数据模型
  - 状态: ✅ 可复用
  - 功能: Pydantic数据模型定义
  - 备注: 需要扩展支持V4.0的新数据结构

#### 1.2 工具模块
- **`tools.py`** - 文件系统工具
  - 状态: ✅ 可复用
  - 功能: 文件读写、目录操作
  - 备注: 基础工具完整，需要扩展支持V4.0新工具

- **`context_collector.py`** - 上下文收集器
  - 状态: ⚠️ 需要重构
  - 功能: 基础文件路径收集
  - 备注: 需要升级为V4.0的智能上下文收集

### 🔄 需要扩展的模块

#### 1.3 缺失的V4.0核心模块
- **MeditationModule** - 问题框架化
  - 状态: ❌ 缺失
  - 功能: 核心洞察报告生成
  - 优先级: 高

- **DebateEngine** - 结构化辩论
  - 状态: ❌ 缺失
  - 功能: 一对一辩论、多轮辩论
  - 优先级: 高

- **ToolSelectionModule** - 工具选择
  - 状态: ❌ 缺失
  - 功能: 工具注册、选择、执行
  - 优先级: 高

- **AgentMemoryNexus** - 混合记忆系统
  - 状态: ❌ 缺失
  - 功能: 工作记忆、情景记忆、语义记忆
  - 优先级: 高

- **ConstitutionalGovernance** - 宪法治理
  - 状态: ❌ 缺失
  - 功能: 动态宪法、治理规则
  - 优先级: 中

## 2. Web应用系统 (zswe-agent-web/)

### ✅ 可复用模块

#### 2.1 后端 (backend/)
- **`main.py`** - FastAPI应用
  - 状态: ✅ 可复用
  - 功能: API端点、中间件、异常处理
  - 备注: 已实现V4.0核心API，需要完善

- **`models.py`** - 数据库模型
  - 状态: ✅ 可复用
  - 功能: SQLAlchemy ORM模型
  - 备注: 已实现V4.0数据模型，需要优化

- **`test_*.py`** - 测试套件
  - 状态: ✅ 可复用
  - 功能: FastAPI TestClient测试
  - 备注: 基础测试完整，需要扩展

#### 2.2 前端 (frontend/)
- **页面组件** - React页面
  - 状态: ✅ 可复用
  - 功能: 用户界面、状态管理
  - 备注: 基础UI完整，需要优化用户体验

- **API集成** - 前端API调用
  - 状态: ✅ 可复用
  - 功能: HTTP客户端、错误处理
  - 备注: 已实现真实API调用，需要完善

### 🔄 需要优化的模块

#### 2.3 用户体验
- **实时更新** - WebSocket支持
  - 状态: ❌ 缺失
  - 功能: 实时工作流状态更新
  - 优先级: 中

- **高级UI组件** - 复杂交互
  - 状态: ⚠️ 部分实现
  - 功能: 拖拽、图表、编辑器
  - 优先级: 低

## 3. VS Code扩展 (zswe-agent-vscode/)

### ✅ 可复用模块

#### 3.1 扩展核心
- **`extension.ts`** - 主入口
  - 状态: ✅ 可复用
  - 功能: VS Code扩展生命周期
  - 备注: 基础扩展完整，需要适配V4.0

- **`workflowManager.ts`** - 工作流管理
  - 状态: ✅ 可复用
  - 功能: 工作流状态管理
  - 备注: 需要扩展支持V4.0新功能

- **`constitutionViewer.ts`** - 宪法查看器
  - 状态: ✅ 可复用
  - 功能: 宪法显示和编辑
  - 备注: 需要增强支持V4.0宪法治理

### 🔄 需要扩展的模块

#### 3.2 V4.0新功能
- **实时协作** - 多用户支持
  - 状态: ❌ 缺失
  - 功能: 团队协作、实时同步
  - 优先级: 中

- **高级调试** - 调试工具
  - 状态: ❌ 缺失
  - 功能: 断点、变量查看、日志
  - 优先级: 低

## 4. 文档系统 (docs/)

### ✅ 可复用模块

#### 4.1 设计文档
- **`SYSTEM_DESIGN.md`** - 系统设计
  - 状态: ✅ 可复用
  - 功能: 架构设计文档
  - 备注: 需要更新为V4.0架构

- **`PRODUCT_REQUIREMENTS.md`** - 产品需求
  - 状态: ✅ 可复用
  - 功能: 产品功能定义
  - 备注: 需要更新为V4.0需求

- **`ZSCE_Agent_V4_Design.txt`** - V4.0设计
  - 状态: ✅ 可复用
  - 功能: V4.0功能设计
  - 备注: 核心设计文档，需要实现

## 5. 优先级建议

### 🔥 高优先级 (立即实现)
1. **MeditationModule** - 问题框架化核心
2. **DebateEngine** - 结构化辩论引擎
3. **ToolSelectionModule** - 工具选择系统
4. **AgentMemoryNexus** - 混合记忆系统

### ⚡ 中优先级 (后续实现)
1. **ConstitutionalGovernance** - 宪法治理
2. **实时更新** - WebSocket支持
3. **实时协作** - 多用户支持

### 📋 低优先级 (优化阶段)
1. **高级UI组件** - 复杂交互
2. **高级调试** - 调试工具
3. **性能优化** - 系统优化

## 6. 技术债务

### 需要重构的模块
1. **`context_collector.py`** - 升级为智能上下文收集
2. **前端状态管理** - 优化复杂状态处理
3. **错误处理** - 统一错误处理机制
4. **日志系统** - 完善日志记录

### 需要测试的模块
1. **所有新V4.0模块** - 单元测试
2. **API集成** - 集成测试
3. **端到端流程** - E2E测试

## 7. 外部依赖

### 需要集成的外部模块
1. **向量数据库** - pgvector (已集成)
2. **LLM服务** - Google Gemini (已集成)
3. **数据库** - PostgreSQL (已集成)
4. **前端框架** - Next.js (已集成)

### 需要评估的外部模块
1. **实时通信** - WebSocket/Socket.io
2. **文件存储** - 云存储服务
3. **监控** - 应用监控
4. **部署** - 容器化部署

## 8. 总结

### 可复用率: ~60%
- 核心Agent系统: 80%可复用
- Web应用系统: 70%可复用
- VS Code扩展: 60%可复用
- 文档系统: 90%可复用

### 主要缺口
1. V4.0核心模块 (MeditationModule, DebateEngine, ToolSelectionModule, AgentMemoryNexus)
2. 实时通信支持
3. 高级UI组件
4. 完整测试覆盖

### 建议策略
1. **保留现有架构** - 基于现有代码扩展
2. **增量开发** - 逐步实现V4.0功能
3. **优先核心功能** - 先实现核心模块
4. **持续重构** - 在开发过程中优化代码质量
